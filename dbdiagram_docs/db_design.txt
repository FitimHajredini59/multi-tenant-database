Enum tenant_status {
  active
  suspended
  inactive
}

Enum order_status {
   pending
   processing
   shipped
   completed
   cancelled
}

Enum payment_status {
  pending
  successful
  failed
}

Enum payment_method {
  mastercard
  visa
  american_express
  paypal
  cash
}

Table tenants {
  id integer [primary key, increment]
  domain varchar [not null, unique]
  status tenant_status [default: 'active']
  created_at timestamp [default: `now()`]
  updated_at timestamp
  deleted_at timestamp
}

Table users {
  id integer [primary key, increment]
  tenant_id integer [not null]
  role_id integer [not null]
  name varchar
  email varchar [not null]
  password_hash varchar [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp
  deleted_at timestamp

  Indexes {
    (tenant_id, email) [unique]
  }
}

Table roles {
  id integer [primary key, increment]
  name varchar [not null, unique]
}

Table permissions {
  id integer [primary key, increment]
  name varchar [not null, unique]
}

Table role_permissions {
  role_id integer [not null]
  permission_id integer [not null]

  Indexes {
    (role_id, permission_id) [pk]
  }
}

Table pages {
  id integer [primary key, increment]
  tenant_id integer [not null]
  slug varchar [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp

  Indexes {
    (tenant_id, slug) [unique]
  }
}

Table page_sections {
  id integer [primary key, increment]
  page_id integer [not null]
  content text
  metadata jsonb
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table page_files {
  id integer [primary key, increment]
  tenant_id integer [not null]
  page_id integer
  path varchar
  metadata jsonb
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table forms {
  id integer [primary key, increment]
  tenant_id integer [not null]
  page_id integer
  title varchar
  slug varchar [note: "Enables embedding a form in multiple pages"]
  metadata jsonb
  created_at timestamp [default: `now()`]
  updated_at timestamp

  indexes {
    (tenant_id, slug) [unique]
  }
}

Table questions {
  id integer [primary key, increment]
  form_id integer [not null]
  is_required bool
  value varchar [note: "The actual question"]
  order integer
  metadata jsonb
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table answers {
  id integer [primary key, increment]
  user_id integer
  question_id integer
  value varchar [note: "The actual answer"]
  metadata jsonb
  created_at timestamp [default: `now()`]
  updated_at timestamp

  Indexes {
    (user_id, question_id) [unique]
  }
}

Table patients {
  id integer [primary key, increment]
  user_id integer [not null]
  tenant_id integer [not null]
  birthdate date [not null]
  gender varchar
  phone_number varchar
  clinical_history jsonb [note: "Optional patient history such as previous illnesses, allergies, smoking, alcohol or other patient info"]

  Indexes {
    (user_id, tenant_id) [unique]
  }
}

Table consultations {
  id integer [primary key, increment]
  patient_id integer [not null]
  doctor_id integer [not null]
  tenant_id integer [not null]
  form_id integer
  symptoms varchar
  current_medications varchar
  diagnosis varchar
  tests varchar [note: "Medical examinations necessary to diagnose a patient"]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table prescriptions {
  id integer [primary key, increment]
  consultation_id integer [not null, ref: - consultations.id]
  usage_instructions varchar
  other_medications varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Table categories {
  id integer [primary key, increment]
  tenant_id integer [not null]
  parent_id integer
  name varchar [not null, unique]
  description text
}

Table products {
  id integer [primary key, increment]
  tenant_id integer [not null]
  title varchar
  description text
  price decimal [check: `price >= 0`]
  prescription_required bool
  image varchar
  stock_quantity integer [check: `stock_quantity >= 0`]
  created_at timestamp [default: `now()`]
  updated_at timestamp
  deleted_at timestamp
}

Table prescription_products {
  prescription_id integer [not null]
  product_id integer [not null]

  Indexes {
    (prescription_id, product_id) [pk]
  }
}

Table product_categories {
  product_id integer [not null]
  category_id integer [not null]

  Indexes {
    (product_id, category_id) [pk]
  }
}

Table orders {
  id integer [primary key, increment]
  user_id integer [not null]
  tenant_id integer [not null]
  status order_status [not null, default: 'pending']
  total_amount decimal [not null]
  shipping_address varchar [not null]
  billing_address varchar
  created_at timestamp [default: `now()`]
  updated_at timestamp
  deleted_at timestamp
}

Table order_items {
  id integer [primary key, increment]
  order_id int [not null]
  product_id int [not null]
  quantity int [not null, check: `quantity > 0`]
}

Table payments {
  id integer [primary key, increment]
  order_id integer [not null, ref: - orders.id]
  payment_method payment_method [not null]
  status payment_status [default: "pending"]
  amount decimal [not null]
  transaction_id varchar [note: "Foreign transaction ID from a third party service"]
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Ref: tenants.id < users.tenant_id
Ref: roles.id < users.role_id
Ref: role_permissions.role_id > roles.id
Ref: role_permissions.permission_id > permissions.id
Ref: tenants.id < pages.tenant_id
Ref: pages.id < page_sections.page_id
Ref: page_files.tenant_id > tenants.id
Ref: page_files.page_id > pages.id
Ref: forms.tenant_id > tenants.id
Ref: forms.page_id > pages.id
Ref: questions.form_id > forms.id
Ref: answers.user_id > users.id
Ref: answers.question_id > questions.id
Ref: patients.user_id > users.id
Ref: patients.tenant_id > tenants.id
Ref: consultations.patient_id > patients.id
Ref: consultations.doctor_id > users.id
Ref: consultations.tenant_id > tenants.id
Ref: consultations.form_id > forms.id
Ref: products.tenant_id > tenants.id
Ref: prescription_products.prescription_id > prescriptions.id
Ref: prescription_products.product_id > products.id
Ref: orders.user_id > users.id
Ref: orders.tenant_id > tenants.id
Ref: order_items.order_id > orders.id
Ref: order_items.product_id > products.id
Ref: categories.tenant_id > tenants.id
Ref: categories.parent_id > categories.id
Ref: product_categories.product_id > products.id
Ref: product_categories.category_id > categories.id
